# 長期フェーズ別ロードマップ

本ドキュメントは、リポジトリ現状を踏まえた段階的な開発ロードマップです。MVP 達成後の将来的な拡張も含め、段階ごとに狙いと主なタスクを整理しています。

## Phase 0: 基盤整備と計画の正規化
- 機能リストを最新実装と照合して改訂し、不要項目や実装済み項目を整理（ドキュメント更新）。
- 既存コードのクリーンアップ（例: dataclass import 抜けの補完、不要ログ除去）と型チェック/静的解析パイプラインの整備。
- GUI を含む自動テスト方針（pytest-qt など）の調査とスモークテスト追加。
- PyInstaller を用いた Windows 向けスタンドアロン実行ファイルの作成手順を確立し、配布前提の検証を先行して行う。

## Phase 1: タイムライン編集の仕上げ (要求 1)
- `MouseController`／`TimelinePlot` に時間・値スナップ、マルチポイント編集（相対移動/数値入力）、キーフレーム一覧テーブルを追加。
- `TimelineHistory` の活用、または `QUndoStack` 拡張でプロジェクト全体の Undo/Redo 一貫性を確保。
- ツールバー／ショートカットの拡充（再生、ズーム、スナップ切替など）とヘルプ UI を追加。

## Phase 2: トラックモデル再設計と種別対応 (要求 2–3)
- `Timeline` を複数 `Track`（List/Dict）管理に拡張し、`SingleTrackPosProvider` や UI を汎用化。
- 各トラック種別（Float/Bool/Event/Enum）に応じたデータモデル、補間/保持ロジック、描画スタイルを実装。
- トラックマネージャ UI（追加・削除・折りたたみ・並べ替え、プリセット適用）を実装し、トラック単位設定を QSettings/プロジェクトファイルに保存。

## Phase 3: 再生・評価機能の拡張 (要求 4)
- `PlaybackController` に再生速度倍率・ループ範囲などの制御を追加し、各トラックの現在値表示と統計メーター（最大値/平均/区間長）を実装。
- 再生状態を視覚化する HUD／数値パネルを `MainWindow` 内に配置し、再生中の UI 応答性を検証。

## Phase 4: 出力とプロジェクト永続化の高度化 (要求 5)
- CSV 出力を多列化（time_s + 各トラック列）、可変サンプリング周期設定、列名のプリセット管理に対応。
- プロジェクト保存形式を JSON/ZIP ハイブリッドへ拡張し、トラック定義・Enum 色設定・UI プリファレンスを含める。
- バージョン管理フィールドと互換性レイヤを `project_io` に追加。

## Phase 5: ライブ配信機能の拡張 (要求 6)
- `TelemetryBridge` に UDP ベースのストリーミングを集約し、JSON/Protobuf 送出を切り替え可能にする。
- 送信メトリクス（実効Hz、遅延、ドロップ率）を UI／ログに表示。
- Telemetry 設定 UI に複数エンドポイントやセッション統計を統合し、エラーハンドリングを強化。

## Phase 6: テンプレ生成と編集効率化 (要求 7)
- カーブテンプレート生成ユーティリティ（台形・ランプ等）を `actions` 層に追加し、範囲リピート／値スケールなどのバッチ操作コマンドを実装。
- コピー＆ペースト、区間の伸縮・反転などの編集機能を `QUndoCommand` ベースで提供し、ショートカットを割り当て。

## Phase 7: 検証・ガードと描画最適化 (要求 8)
- 入力バリデーションとクランプ処理をモデル層に導入し、NaN/Inf 排除や時刻単調増加検査の警告を UI に表示。
- 密集時ラベルの簡略化、ホバー詳細表示、補間結果の決定論性テストを追加。

## Phase 8: UI/UX 強化と国際化 (要求 9)
- トラックごとの色・表示設定、Enum 色編集ダイアログ、テーマ切替（ライト/ダーク）を実装。
- Qt 翻訳フレームワークで日本語/英語 UI を切り替え、ヘルプやチュートリアルを整備。
- キーボードショートカット一覧、カスタマイズ設定、アクセシビリティ改善を実施。

## 継続的事項
- 各フェーズで `documents/` を更新し、README・開発者ガイド・ユーザーガイドを最新状態に保つ。
- 機能追加ごとに回帰テスト・ロードテスト（特にテレメトリ）を拡充し、CI 上で実行する。
- 補間アルゴリズムに Bezier/Ease 系を追加する際は、既存 Linear/Cubic/Step と同じ検証フロー（再生・出力・テレメトリ）を通過させる。
