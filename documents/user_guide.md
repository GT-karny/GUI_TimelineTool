# ユーザーガイド

## アプリの起動とレイアウト
1. 仮想環境を有効化したうえで `python -m app.app` を実行します。
2. メインウィンドウは次の構成です。
   - 上部: 再生や補間設定をまとめた **Timeline Toolbar**。
   - 中央: Telemetry 設定グループ、キーフレーム Inspector、タイムラインプロットが縦方向に並びます。
   - 下部: ステータスバーに操作結果やヒントが表示されます。
3. トラックヘッダーを備えたタイムラインリストから複数の Float トラックを管理できます。各トラックはソロ/ミュートなどのフラグは持たず、値編集に特化した構成です。

## タイムライン編集
- **トラックの管理**
  - 各トラックのヘッダーにある `＋` ボタンで新しい Float トラックを追加できます。
  - ヘッダーのコンテキストメニューからトラックの削除や上下移動を行い、Undo/Redo で復元可能です。
- **キーフレームの追加**
  - タイムライン上をダブルクリックすると、その位置にキーが追加されます。
  - もしくはツールバーの `+` ボタンでプレイヘッド位置に追加できます。
- **キーフレームの移動**
  - 左クリックでキーを選択し、そのままドラッグして時刻と値を変更します。
  - 複数選択は Shift+クリック。空白をドラッグすると矩形選択が行えます。
- **キーフレームの削除**
  - 選択状態でツールバーの `-` ボタンを押すか、右クリックメニューの *Delete Nearest* を選びます。
- **補間モード**
  - ツールバーの `Interpolation` コンボボックスで `cubic` / `linear` / `step` を切り替えます。
- **Inspector での編集**
  - 単一キーを選択すると Inspector に時刻・値が表示され、数値入力で精密に編集できます。
- **Undo/Redo**
  - `Ctrl+Z` / `Ctrl+Y` で直前の操作を取り消し/やり直しできます。

## 再生コントロール
- `▶` 再生: 現在のプレイヘッド位置から再生を開始します。
- `■` 停止: 再生を停止し、プレイヘッドを維持します。
- `⏮` 先頭へ: プレイヘッドを 0 秒に移動します。
- `Loop`: ループ再生の有効/無効を切り替えます（状態は保存されます）。
- `|-|` / `工`: X 軸・Y 軸を自動フィットします。

## Telemetry 設定
1. Telemetry グループで「Enable UDP telemetry」をオンにすると送信が有効化されます。
2. IP・Port・Rate (Hz)・Session ID を入力します。未入力の場合は既定値が使用されます。
3. 再生中のみ最新フレームを JSON 形式で送信します。`tools/udp_recv.py` で受信を確認できます。

## CSV エクスポート
1. ツールバーの `Export CSV` ボタン、またはメニューバー **File → Export CSV…** を選択します。
2. 書き出しレートはツールバーの `Sample` フィールドで設定した値が使用されます。
3. 出力ファイルには `time_s` 列と各トラックの `track_<sanitized_name>` 列（同名は `_2` などの連番付き）が含まれます。

## プロジェクト保存と読込
- **Save File / Save File as name**: 現在のタイムラインを JSON ファイルとして保存します。
- **Load File**: 保存済みプロジェクトを読み込み、キーと補間設定を復元します。
- **New File**: タイムラインを初期状態（0 秒 / duration 秒の 2 キー）にリセットします。

## よくある質問
- **Q. 追加したトラックが見当たりません。**
  - A. トラックヘッダーのリストをスクロールし、必要に応じてヘッダー右側のメニューから表示順を調整してください。Undo/Redo で削除操作も元に戻せます。
- **Q. Telemetry をオフにしているのに送信されます。**
  - A. Telemetry グループのチェックボックスがオンになっていないか確認してください。オフの状態では送信スレッドは起動しません。
- **Q. Undo/Redo が効かない操作があります。**
  - A. テレメトリ設定の変更やビュー操作など、一部の UI 操作は Undo 対象外です。キーフレーム編集や追加/削除は Undo 対象です。
