# ユーザーガイド

## 初回起動と UI の構成
1. `python -m app.app` でアプリケーションを起動すると、中央にタイムラインエディタ、左側にトラック一覧、上部にツールバーが表示されます。
2. ツールバーの主なボタン:
   - ▶ 再生 / ⏸ 一時停止 / ■ 停止
   - 🔁 ループ再生切り替え
   - ⏱ 再生位置インジケータとシークバー
   - 📄 CSV エクスポート、📡 テレメトリ設定ダイアログ
3. トラックエリアで右クリックすると、トラック追加やキーフレーム挿入のメニューが開きます。

## タイムライン編集
- **キーフレーム追加**: 対象トラック上で任意の時間にカーソルを合わせ、右クリック → *Add Keyframe*。
- **キーフレーム移動**: ドラッグで時間・値の両方を変更できます。Shift キーを押しながらドラッグすると時間軸方向にスナップします。
- **補間モード**: キーフレームを選択して右クリック → *Interpolation* から `Cubic` / `Linear` / `Step` を選択。複数選択にも対応します。
- **トラック操作**: トラックヘッダでミュート/ソロ、削除などを行います。

## 再生コントロール
- **再生 (▶)**: カーソル位置から再生を開始します。ループが有効な場合、終端で先頭へ戻ります。
- **一時停止 (⏸)**: 現在位置を保持したまま送信・更新を止めます。
- **停止 (■)**: 再生を停止し、カーソルが先頭に戻ります。
- **ループ (🔁)**: 再生中でも切り替え可能。状態は `/playback/loop_enabled` に保存されます。

## CSV エクスポート
1. メニューバーの **File → Export CSV…** を選択します。
2. 書き出し範囲はタイムライン全体です。ファイルには `time_ms`, `track`, `value` の列が含まれます。
3. 既存ファイルを上書きする場合は、ダイアログで確認が表示されます。

## 設定の保存と復元
- アプリは Qt の QSettings を用いて設定を永続化します。例: ループ再生やテレメトリ宛先。
- 設定は OS 標準のパスに保存され、自動で読み込まれます。複数プロジェクトで設定を分けたい場合は、環境変数やアプリケーション ID を変更してください。

## テレメトリ設定
1. ツールバーの 📡 ボタン（または **View → Telemetry**）を開きます。
2. 「UDP 送信を有効化」にチェックを入れると、宛先 IP/Port/Rate/Session ID を設定できるようになります。
3. 再生中のみ JSON メッセージが送られます。詳細仕様は [telemetry.md](telemetry.md) を参照してください。

## FAQ
**Q. 再生しても値が変化しません。**  
A. 対象トラックにキーフレームが存在するか、補間モードが意図したものか確認してください。Step 補間では値が段階的に更新されます。

**Q. UDP テレメトリが受信されません。**  
A. `tools/udp_recv.py` でローカル受信をテストし、アプリ側で再生中であること、宛先 IP/ポートが一致していることを確認してください。

**Q. 設定をリセットしたい。**  
A. アプリを終了した状態で QSettings の保存ファイルを削除してください（OS ごとに保存場所が異なります）。再起動すると既定値に戻ります。

**Q. CSV の小数点以下桁数を調整したい。**  
A. 書き出し後に表計算ソフトやスクリプトで処理してください。現在のバージョンでは桁数指定は UI から変更できません。
